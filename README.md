```markdown
# Напоминание о брошенной корзине (Laravel 9)

**Обзор проекта**  
Система напоминания о брошенной корзине предназначена для уведомления пользователей, 
которые оставили товары в корзине без завершения покупки, после периода неактивности. 
Система автоматически отправляет напоминание на электронную почту, чтобы побудить пользователей завершить покупку. 
Проект построен на Laravel 9 и PHP 8.1 с использованием событийной архитектуры и асинхронной обработки задач.

---

## Возможности
- **Обнаружение брошенных корзин**: Отслеживает, когда корзина не обновлялась в течение более 24 часов, и инициирует событие.
- **Отправка уведомлений по email**: Отправляет пользователям уведомления о брошенной корзине.
- **Очередь задач**: Использует систему очередей Laravel для асинхронной отправки напоминаний.
- **Консольная команда**: Позволяет вручную отправлять напоминания о брошенных корзинах для тех, 
  кто не завершил покупку в течение 24 часов.

---

## Технологический стек

- **Backend**:  
  - PHP 8.1
  - Laravel 9

- **Email**:  
  - Laravel Mail Notifications
  
- **База данных**:  
  - MySQL
  
- **Очереди**:  
  - Laravel Job Queue (для асинхронной обработки задач)

---

## Структура проекта

```
├── app
│   ├── Console
│   │   └── Commands
│   │       └── SendAbandonedCartEmails.php
│   ├── Events
│   │   └── CartAbandoned.php
│   ├── Http
│   │   └── Controllers
│   │       └── CartController.php
│   ├── Jobs
│   │   └── SendAbandonedCartEmailJob.php
│   ├── Listeners
│   │   └── NotifyUserAboutAbandonedCart.php
│   ├── Models
│   │   └── Cart.php
│   ├── Notifications
│   │   └── AbandonedCartNotification.php
│   └── Observers
│       └── CartObserver.php
├── routes
│   └── api.php
└── tests
└── Feature
└── CartTest.php
```

---

## Инструкции по настройке

1. **Клонируйте репозиторий**  
   Клонируйте репозиторий на ваш локальный компьютер:
   ```bash
   git clone https://github.com/yourusername/abandoned-cart-reminder.git
   cd abandoned-cart-reminder
   ```

2. **Установите зависимости**  
   Установите зависимости проекта с помощью Composer:
   ```bash
   composer install
   ```

3. **Настройка окружения**  
   Скопируйте файл `.env.example` в `.env` и настройте параметры подключения к базе данных:
   ```bash
   cp .env.example .env
   ```

4. **Генерация ключа приложения**  
   Сгенерируйте ключ приложения:
   ```bash
   php artisan key:generate
   ```

5. **Запуск миграций**  
   Запустите миграции для создания необходимых таблиц:
   ```bash
   php artisan migrate --seed
   ```

6. **Настройка очередей**  
   Убедитесь, что вы настроили драйвер очереди в файле `.env` (например, `QUEUE_CONNECTION=database`). Затем запустите обработчик очередей:
   ```bash
   php artisan queue:work
   ```

7. **Запуск проекта**
   ```bash
   php artisan serve
   ```

---

## Использование

### 1. **Обнаружение брошенных корзин**

Система автоматически обнаруживает брошенные корзины, отслеживая поле `updated_at` в таблице `carts`. Если корзина не была обновлена в течение 24 часов, срабатывает событие `CartAbandoned`.

### 2. **Отправка уведомлений по email**

Когда корзина считается брошенной, пользователю отправляется уведомление на email, напоминающее ему о завершении покупки.

### 3. **Консольная команда**
Вы можете вручную запустить отправку напоминаний о брошенных корзинах с помощью следующей команды Artisan:
```bash
php artisan emails:send-abandoned-cart
```

Эта команда проверит корзины, которые не были обновлены более 24 часов, и отправит напоминания.

### 4. **Observer**
`CartObserver` автоматически инициирует событие брошенной корзины при обновлении корзины.

---

## Тестирование

Запустите тесты с помощью PHPUnit:
```bash
php artisan test
```

---

## Настройка

- **Модель Cart**:  
  Модель `Cart` можно расширить дополнительными полями (например, итоговая сумма корзины, детали товаров).

- **Шаблон уведомления**:  
  Измените класс `AbandonedCartNotification`, чтобы настроить шаблон email-уведомления.

- **Каналы уведомлений**:  
  Класс `AbandonedCartNotification` можно расширить для поддержки других каналов уведомлений (например, SMS, push-уведомления).

---

## Примечания

- Система предполагает, что корзины связаны с пользователями, и что каждая корзина имеет поле `updated_at`.
- Для приложений с большой нагрузкой рекомендуется использовать более продвинутую очередь, например, Redis, для обработки задач.
- Возможно, вам нужно будет настроить порог времени в 24 часа в зависимости от ваших требований.

---
